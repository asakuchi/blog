{"componentChunkName":"component---src-templates-blog-post-js","path":"/javascript/gatsby/gatsby-auto-deploy/","result":{"data":{"site":{"siteMetadata":{"title":"あさくちブログ"}},"markdownRemark":{"id":"c36a2892-982c-56d2-bac5-da9aa4becc32","excerpt":"で作ったブログを GitHub Pages で公開したい。\n以下のドキュメントの通り進める。 https://www.gatsbyjs.com/docs/how-gatsby-works-with-github-pages…","html":"<p><code class=\"language-text\">Gatsby</code> で作ったブログを GitHub Pages で公開したい。\n以下のドキュメントの通り進める。</p>\n<p><a href=\"https://www.gatsbyjs.com/docs/how-gatsby-works-with-github-pages\">https://www.gatsbyjs.com/docs/how-gatsby-works-with-github-pages</a></p>\n<p>（手順の中でサブディレクトリの設定もあるので<a href=\"../gatsby-sub-directory/\">前回</a>の記事いらなかった・・・）</p>\n<p>まずは空の <code class=\"language-text\">gh-pages</code> ブランチを作成する。\nここに build 後のファイルを deploy していくことになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">git</span> checkout --orphan gh-pages\n$ <span class=\"token function\">git</span> checkout --orphan gh-pages\n$ <span class=\"token function\">git</span> commit --allow-empty -m <span class=\"token string\">\"root commit\"</span></code></pre></div>\n<p>npm パッケージのインストール。deploy するのに使います。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install gh-pages --save-dev</code></pre></div>\n<p>gatsby-config.js の設定変更。（前回実施済みだが）</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  pathPrefix<span class=\"token operator\">:</span> <span class=\"token string\">\"/blog\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>package.jsonの修正。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby build --prefix-paths &amp;&amp; gh-pages -d public\"</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>上記の設定をすることで簡単に deploy できるようになる。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">npm</span> run deploy</code></pre></div>\n<p>せっかくなので push したら deploy されるように <code class=\"language-text\">Github Actions</code> の設定もする。</p>\n<script src=\"https://gist-it.appspot.com/github/asakuchi/blog/blob/main/.github/workflows/main.yml\"></script>\n<p>デフォルトの yml ファイルに、このあたりを追加しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> deploy gh<span class=\"token punctuation\">-</span>pages\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          git config --global user.email \"paleapricot.asakuchi@gmail.com\"\n          git config --global user.name \"asakuchi\"\n          git remote set-url origin https://${GITHUB_ACTOR}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\n          npm ci\n          npm run deploy</span></code></pre></div>","frontmatter":{"title":"Gatsby で作ったブログを Github Pages で公開する","date":"December 04, 2020","description":null}},"previous":{"fields":{"slug":"/javascript/gatsby/gatsby-sub-directory/"},"frontmatter":{"title":"Gatsby サブディレクトリを設定する"}},"next":{"fields":{"slug":"/javascript/gatsby/gatsby_edges-node-date_vs_node-data/"},"frontmatter":{"title":"【Gatsby】 GraphQL の edges.node.data と nodes.data の違いって何？"}}},"pageContext":{"id":"c36a2892-982c-56d2-bac5-da9aa4becc32","previousPostId":"b874568c-aadf-5f52-b75d-775b3c05b49c","nextPostId":"17c5e1c8-5159-5d34-96e5-da506880ecd0"}},"staticQueryHashes":["2841359383","3348849317"]}